<!DOCTYPE html>
<html lang="ja"><head>
   <meta charset="utf-8" />
   <meta name="Author" content="Takashi Masuyama" />
   <meta name="viewport" content="width=device-width" />
   <script src="../js/lib/jquery-2.1.4.min.js"></script>
   <script src="../js/lib/d3.min.js"></script>
   <script src="js/plot.js"></script>
   <style>
     #chart {
     width: 800px;
     height: 400px;
     }

     #chart .domain,
     #chart .line {
     fill: none;
     stroke: #000;
     }

   </style>
   <title>Chart</title>
</head>
<body>
  <label><input type="checkbox">Animate</input></label>
  <div id="chart"></div>
  <script>
    var animate = false;
    
    var h = location.hash;
    if(h != null && h != ""){
        animate = (h == "#animate");
    }
    var start = new Date().getTime();
    var data = sample_ts(start);
    var peek_count = 0;
    for(var i = 0; i < data.length; i++){
		       //if(data[i].value >= 1){
     if(data[i].value > 0.8){
         data[i].mark = true;
      console.log("marked", data[i]);
      }
       else {
         data[i].mark = false;
       }
    }

      if(animate){

    $(function(){
      setInterval(function() {
      var now = new Date().getTime();
      
      var peek_count = 0;
      var value = Math.cos((now-start)*Math.PI/30);
      var mark = false;
      if(value > 0.8){
	mark = true;
	}
      var row = {timestamp: now, value: value, mark: mark };
	data.push(row);
	plot_ts(data, "chart");
	}, 2000);
	})
      }
      else {
      plot_ts(data, "chart");
      }


    </script>
</body></html>
